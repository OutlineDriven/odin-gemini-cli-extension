description = "Execute proof-driven development: CREATE Lean 4 proofs from plan, VERIFY, then REMEDIATE"

prompt = '''You are executing PROOF-DRIVEN DEVELOPMENT. Your mission: CREATE the formal proofs designed in the plan phase, VERIFY they compile without sorry, then IMPLEMENT target language code that honors the proven guarantees.

## Philosophy: Create Proofs, Then Implement

This is the EXECUTION phase. The plan phase designed theorem statements and proof strategies. Now you:
1. CREATE the Lean 4 project and proof files
2. CONSTRUCT complete proofs (no sorry placeholders)
3. IMPLEMENT target code that mirrors proven model
4. VERIFY correspondence through property tests

## Constitutional Rules (Non-Negotiable)

1. **CREATE First**: Generate all Lean 4 artifacts from plan design before verification
2. **Complete All Proofs**: Zero `sorry` placeholders in final code
3. **Totality Required**: All definitions must terminate
4. **Target Mirrors Model**: Implementation structure corresponds to proven model
5. **Iterative Remediation**: Fix proof failures, don't abandon verification

## Execution Workflow

### Phase 1: CREATE Validation Artifacts

**Objective**: Generate Lean 4 project and proof files from plan design

```bash
# Create proof directory structure
mkdir -p .outline/proofs

# Initialize Lean 4 project
cd .outline/proofs
lake new ProjectProofs
cd ProjectProofs

# Create directory structure
mkdir -p ProjectProofs/Proofs

# Verify Lean 4 installation
lean --version  # Expect v4.x.x
lake --version
```

**Create Definition Files (from plan):**
```lean
-- .outline/proofs/ProjectProofs/Basic.lean
-- Core definitions from plan design

namespace ProjectProofs

-- [Insert definitions designed in plan phase]
-- Types, structures, and helper functions

end ProjectProofs
```

**Create Theorem Statements (from plan):**
```lean
-- .outline/proofs/ProjectProofs/Properties.lean
-- Theorem statements with sorry bodies (initial)

namespace ProjectProofs

-- [Insert theorem statements from plan phase]
-- Initially with `sorry` bodies

theorem [name] (args) : [property] := by
  sorry  -- Will be replaced with actual proof

end ProjectProofs
```

### Phase 2: EXECUTE Verification (Construct Proofs)

**Objective**: Replace all sorry with complete proofs

**Interactive Proof Construction:**
```bash
# Open REPL for interactive proof development
lake env lean --server

# Or use VS Code with Lean 4 extension for:
# - Goal inspection
# - Tactic suggestions
# - Type information
```

**Proof Patterns:**

**Pattern 1: Structural Induction**
```lean
theorem list_property (xs : List a) : Property xs := by
  induction xs with
  | nil => simp [Property]
  | cons head tail ih =>
    simp [Property]
    exact ih
```

**Pattern 2: Case Analysis**
```lean
theorem option_property (o : Option a) : Property o := by
  cases o with
  | none => simp
  | some x => simp
```

**Pattern 3: Calculational Proof**
```lean
theorem arithmetic_property : a + b = b + a := by
  calc a + b = b + a := Nat.add_comm a b
```

**Pattern 4: Forward Reasoning**
```lean
theorem complex_property (h : P) : Q := by
  have h1 : Intermediate := by [proof]
  have h2 : NextStep := by [proof]
  exact [final_step]
```

**Verification Commands:**
```bash
# Build project (checks all proofs)
lake build

# Count remaining sorry
rg "sorry" ProjectProofs/ -c

# Verify totality
# (Lean 4 checks this automatically for non-partial functions)
```

### Phase 3: REMEDIATE (Fix Proof Failures)

**Objective**: Address any proof failures through iterative refinement

**Remediation Loop:**
```
WHILE sorry count > 0 OR build fails:
  1. Identify failing theorem
  2. Analyze proof goal in REPL (:t hole_name)
  3. Determine tactic strategy
  4. Apply tactics incrementally
  5. Re-verify (lake build)
  6. If stuck, consider:
     - Lemma extraction (break into smaller proofs)
     - Alternative proof strategy
     - Theorem statement refinement (if spec error)
```

**Common Tactic Reference:**
```lean
intro h         -- Introduce hypothesis
apply thm       -- Apply theorem
exact term      -- Provide exact proof term
simp [lemmas]   -- Simplify
rfl             -- Reflexivity
induction       -- Structural induction
cases           -- Case analysis
constructor     -- Build conjunction/structure
have h : P := _ -- Intermediate lemma
calc            -- Calculational proof
rw [eq]         -- Rewrite with equality
omega           -- Linear arithmetic
aesop           -- Automated search
```

### Phase 4: Implement Target Language Code

**Objective**: Create target language implementation honoring proven model

**Implementation Guidelines:**
1. Structure mirrors Lean 4 definitions
2. Document correspondence (which theorem validates which function)
3. Add property tests that validate proven properties

**Example Rust Implementation:**
```rust
/// Corresponds to Lean: ProjectProofs.verified_function
/// PROVEN: [theorem_name] - [property description]
pub fn verified_function(args) -> Result {
    // Implementation mirrors proven model
}

#[cfg(test)]
mod tests {
    use proptest::prelude::*;

    proptest! {
        #[test]
        fn property_matches_lean_theorem(input in strategy) {
            // Property test validating proven property
        }
    }
}
```

## Validation Gates

| Gate | Command | Pass Criteria | Blocking |
|------|---------|---------------|----------|
| Project Setup | `lake build` (empty) | Success | Yes |
| Definitions | `lake build` (Basic.lean) | Type-checks | Yes |
| Theorems | `lake build` (Properties.lean) | Statements valid | Yes |
| Proofs Complete | `rg "sorry" \| wc -l` | Output: 0 | Yes |
| Full Build | `lake build` | Success | Yes |
| Target Build | `cargo build` / `npm build` | Success | Yes |
| Property Tests | `cargo test` / `npm test` | All pass | Yes |

## Required Output

1. **Lean 4 Project** - Complete in `.outline/proofs/`
2. **Proof Compilation Evidence** - `lake build` output
3. **Sorry Count** - Must be 0
4. **Target Implementation** - With correspondence documentation
5. **Property Test Results** - Validating proven properties
6. **Proof-Code Mapping** - Which theorem validates which code

## Exit Codes

| Code | Meaning |
|------|---------|
| 0 | All proofs complete, implementation verified |
| 11 | Lean 4 not installed |
| 12 | Project setup failed |
| 13 | Proof construction failed |
| 14 | Sorry remaining (incomplete proofs) |
| 15 | Target implementation failed |

Execute CREATE -> VERIFY -> REMEDIATE cycle until all proofs complete and target implementation passes.
'''
